<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>powershell</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="powershell"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://mettcon.github.io/notes/ispyuxecejflrr2t0trxrmg/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="9/21/2022"/><meta property="article:modified_time" content="9/22/2022"/><link rel="canonical" href="https://mettcon.github.io/notes/ispyuxecejflrr2t0trxrmg/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/2a1ea1ae6d4ffa74.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2a1ea1ae6d4ffa74.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-32e56e741dd21442.js" defer=""></script><script src="/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/_next/static/chunks/main-c4b0e551a2150d17.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9ae633c69cbb1e91.js" defer=""></script><script src="/_next/static/chunks/855-124c7d93158bd007.js" defer=""></script><script src="/_next/static/chunks/776-959ab9b5289532fd.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-9c4f89da4e36492e.js" defer=""></script><script src="/_next/static/Q6M1FyBYz7HEWeAkjyRcd/_buildManifest.js" defer=""></script><script src="/_next/static/Q6M1FyBYz7HEWeAkjyRcd/_ssgManifest.js" defer=""></script><script src="/_next/static/Q6M1FyBYz7HEWeAkjyRcd/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div class="main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="powershell"><a aria-hidden="true" class="anchor-heading" href="#powershell"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>powershell</h1>
<h2 id="internal-optimization"><a aria-hidden="true" class="anchor-heading" href="#internal-optimization"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>internal optimization</h2>
<p>Es kam mal wieder das Thema <code>$array += $something</code> auf. Inzwischen sollte weitgehend bekannt sein, dass es böse ist. Es steht sogar im Handbuch.
<a href="https://learn.microsoft.com/en-us/powershell/scripting/dev-cross-plat/performance/script-authoring-considerations?view=powershell-7.2#array-addition">Aufklärung</a><br>
Kurze Erklärung:<br>
Arrays sind Immutable (unveränderbar). Also wird in jeder Runde aus dem Array und dem hinzuzufügendem Objekt ein neues Array erstellt.
Interaktiv mit einer Handvoll Objekten fällt das kaum ins Gewicht, bei mehr Objekten wird es aber schnell problematisch.<br>
(Ausserdem zeigt es mangelndes Verständnis darüber wie Powershell funktionert. Nutzt die Pipeline )</p>
<p>Zum Thema:
Die Benchmarks wurden mit <code>Measure-Command { &#x3C;# code to Bench #> }</code> gemacht und ich erinnerte mich an einen Kommentar von <a href="https://github.com/SeeminglyScience">SeeminglyScience</a> dass in dem Test die Optimierung fehlt. Die Lösung ist es den zu testenden Code in einen Scriptblock zu packen. <code>Measure-Command { { &#x3C;# code to Bench #>} }</code><br>
Ein paar Fehlversuche später habe ich noch mal nachgefragt und <a href="https://gist.github.com/Mettcon/0e333fde41345e1e875289bf4828995a">diese Benchmarks</a> () brachten das erwartete Ergebnis.<br>
Die Optimierungen betreffen also hauptsächlich Variablen in fremden Scopes. Daher die übergaben. <code>{ $emptyArray = $emptyArray; $Iterations = $Iterations;...}</code>  </p>
<p>Unoptimiert wird jeder Variablenzugriff mit <code>VariableOps.GetVariableValue</code> durchgeführt. Womit die Variablen über mehrere Scopes gesucht werden.<br>
Eine lokale Variable stattdessen ist nur ein Property Zugriff einer internen Klasse.<br>
Meine große Erkenntnis hier war, dass das nicht nur für <code>Measure-Command</code> gilt, sondern für Powershell generell.<br>
Der Performance Gewinn der Optimisierung wird fast immer nur marginal sein, aber es ist Performance for free, wenn man sich an guten Stil hält, überraschungen vermeidet und evtl. sogar Schwierigkeiten mit dem Strictmode vermeidet. </p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#internal-optimization" title="internal optimization">internal optimization</a></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"ispyuxecejflrr2t0trxrmg","title":"powershell","desc":"","updated":1663828031394,"created":1663743363872,"custom":{},"fname":"Notes from the field.powershell","type":"note","vault":{"fsPath":"vault"},"contentHash":"8ab6c4775c4494b03b83a455968368a9","links":[],"anchors":{"internal-optimization":{"type":"header","text":"internal optimization","value":"internal-optimization","line":8,"column":0,"depth":2}},"children":[],"parent":"cj841uoi4a89gvhzf6qss2u","data":{}},"body":"\u003ch1 id=\"powershell\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#powershell\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003epowershell\u003c/h1\u003e\n\u003ch2 id=\"internal-optimization\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#internal-optimization\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003einternal optimization\u003c/h2\u003e\n\u003cp\u003eEs kam mal wieder das Thema \u003ccode\u003e$array += $something\u003c/code\u003e auf. Inzwischen sollte weitgehend bekannt sein, dass es böse ist. Es steht sogar im Handbuch.\n\u003ca href=\"https://learn.microsoft.com/en-us/powershell/scripting/dev-cross-plat/performance/script-authoring-considerations?view=powershell-7.2#array-addition\"\u003eAufklärung\u003c/a\u003e\u003cbr\u003e\nKurze Erklärung:\u003cbr\u003e\nArrays sind Immutable (unveränderbar). Also wird in jeder Runde aus dem Array und dem hinzuzufügendem Objekt ein neues Array erstellt.\nInteraktiv mit einer Handvoll Objekten fällt das kaum ins Gewicht, bei mehr Objekten wird es aber schnell problematisch.\u003cbr\u003e\n(Ausserdem zeigt es mangelndes Verständnis darüber wie Powershell funktionert. Nutzt die Pipeline )\u003c/p\u003e\n\u003cp\u003eZum Thema:\nDie Benchmarks wurden mit \u003ccode\u003eMeasure-Command { \u0026#x3C;# code to Bench #\u003e }\u003c/code\u003e gemacht und ich erinnerte mich an einen Kommentar von \u003ca href=\"https://github.com/SeeminglyScience\"\u003eSeeminglyScience\u003c/a\u003e dass in dem Test die Optimierung fehlt. Die Lösung ist es den zu testenden Code in einen Scriptblock zu packen. \u003ccode\u003eMeasure-Command { { \u0026#x3C;# code to Bench #\u003e} }\u003c/code\u003e\u003cbr\u003e\nEin paar Fehlversuche später habe ich noch mal nachgefragt und \u003ca href=\"https://gist.github.com/Mettcon/0e333fde41345e1e875289bf4828995a\"\u003ediese Benchmarks\u003c/a\u003e () brachten das erwartete Ergebnis.\u003cbr\u003e\nDie Optimierungen betreffen also hauptsächlich Variablen in fremden Scopes. Daher die übergaben. \u003ccode\u003e{ $emptyArray = $emptyArray; $Iterations = $Iterations;...}\u003c/code\u003e  \u003c/p\u003e\n\u003cp\u003eUnoptimiert wird jeder Variablenzugriff mit \u003ccode\u003eVariableOps.GetVariableValue\u003c/code\u003e durchgeführt. Womit die Variablen über mehrere Scopes gesucht werden.\u003cbr\u003e\nEine lokale Variable stattdessen ist nur ein Property Zugriff einer internen Klasse.\u003cbr\u003e\nMeine große Erkenntnis hier war, dass das nicht nur für \u003ccode\u003eMeasure-Command\u003c/code\u003e gilt, sondern für Powershell generell.\u003cbr\u003e\nDer Performance Gewinn der Optimisierung wird fast immer nur marginal sein, aber es ist Performance for free, wenn man sich an guten Stil hält, überraschungen vermeidet und evtl. sogar Schwierigkeiten mit dem Strictmode vermeidet. \u003c/p\u003e","noteIndex":{"id":"2ajryvqow43elplox2nvgt0","title":"Hello Visitor","desc":"","updated":1661772283606,"created":1648766726999,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"fb58128cb062cae72be31155f03654c1","links":[],"anchors":{"stay-a-while-and-listen":{"type":"header","text":"Stay a while and listen","value":"stay-a-while-and-listen","line":7,"column":0,"depth":1},"lookup":{"type":"header","text":"Lookup","value":"lookup","line":17,"column":0,"depth":2}},"children":["kmodkqrr8soyq59b5twkopo","cj841uoi4a89gvhzf6qss2u"],"parent":null,"data":{},"body":"# Stay a while and listen\n\nAwesome, right? Even better, you can hire me. But don't get too excited yet.\nI may have not seen much of the IT Industry yet, but what I've seen so far was dissapointing.\nI want a place and colleagues from which I can learn at the job.\nI want to work with people who are interested and don't reject everything with \"I don't have time for that\".\nI'm sick of wasting my time Google bungling, because no one has a clue what we're doing and is stuck in ancient Times.\n\n\n\n## Lookup\n\nThis section contains useful links to related resources.\n\n- [Github](https://github.com/Mettcon)\n- Discord: Saine#4136\n\n\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enableSmartRefs":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"siteUrl":"https://mettcon.github.io","enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enablePrettyLinks":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"ispyuxecejflrr2t0trxrmg"},"buildId":"Q6M1FyBYz7HEWeAkjyRcd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>